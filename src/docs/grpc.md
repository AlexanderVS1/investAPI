#Протокол взаимодействия с TINKOFF INVEST API

Вся работа с TINKOFF INVEST API происходит по протоколу gRPC, документацию которого можно найти по ссылке:
[https://grpc.io/docs/](https://grpc.io/docs/). 

Одной из ключевых особенностей протокола следует назвать Bidirectional-stream — это особый режим работы, 
при котором открывается одно стрим-соединение, отправлять сообщения в которое могут оба участника 
взаимодействия. Это позволяет более гибко и оперативно реализовать работу. Например, 
bidirectional-stream [сервиса котировок](/investAPI/head-marketdata/) 
в одном и том же соединении принимает сообщения об изменении статуса подписки и предоставляет различные 
виды биржевой информации (стаканы, свечи, поток обезличенных сделок и т.д.). Подробнее о данном режиме 
работы можно ознакомиться в [документации протокола](https://grpc.io/docs/what-is-grpc/core-concepts/).

##Авторизация в TINKOFF INVEST API

Для успешной работы с TINKOFF INVEST API требуется передавать токен доступа в metadata
каждого запроса.

Формат заголовка: 
`Authorization: Bearer [токен доступ]`

Например:
`Authorization: Bearer t.QtEo8ahkNFX4RTpbqp0u4z4GDZq27HzUp6AotJASBx7_DVqmqZMHfM2Cy7JmUjS80boI9eVg`

<a name="tracking"></a>
##tracking-id запросов

Во все ответы unary-методов TINKOFF INVEST API добавляется заголовок **x-tracking-id**. 
Это уникальный uuid-идентификатор запроса, который необходим технической поддержке для разбора различных 
инцидентов. При обращении в службу технической поддержки обязательно указывайте **tracking-id** запроса, 
это ускорит решение вашего вопроса. 

*Для сообщений управления статусом подписки в рамках stream-соединений **tracking-id** передаётся явно в
виде выходного параметра.*

##Appname запросов

TINKOFF INVEST API позволяет в запросах добавлять служебный заголовок **x-app-name**, который 
нужен для сбора статистики по используемым инструментам. Если вы разработчик SDK, рекомендуется
использовать app-name формата *<Ник в GitHub>.<Название репозитория>*. Например, **user.tinkoffSDK**.

##Рекомендации по тестированию методов TINKOFF INVEST API

Для тестирования работы TINKOFF INVEST API можно использовать любой доступный grpc-клиент. 
Команда разработки рекомендует воспользоваться BloomRPC. Скачать данный клиент можно по ссылке: 
[bloomrpc releases](https://github.com/uw-labs/bloomrpc/releases).

Интерфейс утилиты достаточно прост, для старта работы требуется указать домен сервиса и импортировать
все proto-файлы. 

1. В поле, обозначенное цифрой 1, введите домен сервиса TINKOFF INVEST API.
![Интерфейс BloomRPC](/investAPI/img/bloom_1.png "Интерфейс BloomRPC")
2. Нажмите кнопку *Import protos* (цифра 2) и выберете все proto-файлы сервиса.
![Интерфейс BloomRPC](/investAPI/img/bloom_2.png "Интерфейс BloomRPC")
3. В поле metadata добавьте заголовок с вашим токеном доступа.
4. Слева в меню вы увидите полный набор доступных методов, в том числе стрим-соединения.
5. Для выполнения запроса следует выбрать необходимый метод, указать входные параметры и
нажать зелёную кнопку со значком play.
![Интерфейс BloomRPC](/investAPI/img/bloom_3.png "Интерфейс BloomRPC")

